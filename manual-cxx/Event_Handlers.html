<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

  <head>
    <title>Event Handlers - Panda3D Manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="style.css" type="text/css"><link rel="shortcut icon" href="favicon.ico">    <meta name="keywords" content="Panda3D, Panda, 3D, Python, graphics, free, game, engine, game rendering engine, simulation, open source, free download, Disney, ETC, Entertainment Technology Center, open-source">
    <meta name="description" content="Free open source 3D game and simulation engine developed by Disney and maintained by Carnegie Mellon University\'s Entertainment Technology Center">
    </head>
    <body>
<table width=960 cellpadding=0 cellspacing=0 id=main align=center>
<tr>
<td id=borderleft></td>
<td id=maincenter valign=top>
<tr><td id=pcontent valign=top><h2>Panda3D Manual: Event Handlers</h2>
<div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Task_Chains.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Main_Loop.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div class='wikicontent' id='wikicontentid'><p>Events occur either when the user does something (such as clicking a <a href="Mouse_Support.html" title="Mouse Support">mouse</a> or pressing a <a href="Keyboard_Support.html" title="Keyboard Support">key</a>) or when sent by the script using <code>messenger.send()</code>.  When an event occurs, Panda's "messenger" will check to see if you have written an "event handler" routine.  If so, your event handler will be called.  The messenger system is object-oriented, to create an event handler, you have to first create a class that inherits from DirectObject.  Your event handler will be a method of your class.
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="Event_Handlers.html#Defining_a_class_that_can_Handle_Events"><span class="tocnumber">1</span> <span class="toctext">Defining a class that can Handle Events</span></a></li>
<li class="toclevel-1"><a href="Event_Handlers.html#Event_Handling_Functions"><span class="tocnumber">2</span> <span class="toctext">Event Handling Functions</span></a></li>
<li class="toclevel-1"><a href="Event_Handlers.html#Sending_Custom_Events"><span class="tocnumber">3</span> <span class="toctext">Sending Custom Events</span></a></li>
<li class="toclevel-1"><a href="Event_Handlers.html#A_Note_on_Object_Management"><span class="tocnumber">4</span> <span class="toctext">A Note on Object Management</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Defining_a_class_that_can_Handle_Events">Defining a class that can Handle Events</span></h2>
<p>The first step is to import class DirectObject:
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">from</span> direct.<span style="color: black;">showbase</span> <span style="color: #ff7700;font-weight:bold;">import</span> DirectObject</pre>
<p>With DirectObject loaded, it is possible to create a subclass of DirectObject. This allows the class to inherit the messaging API and thus listen for events.
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">class</span> myClassName<span style="color: black;">&#40;</span>DirectObject.<span style="color: black;">DirectObject</span><span style="color: black;">&#41;</span>:</pre>
<p>The sample below creates a class that can listen for events. The "accept" function notifies panda that the printHello method is an event handler for the mouse1 event.  The "accept" function and the various event names will be explained in detail later.
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">class</span> Hello<span style="color: black;">&#40;</span>DirectObject.<span style="color: black;">DirectObject</span><span style="color: black;">&#41;</span>:<br />  <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />    <span style="color: #008000;">self</span>.<span style="color: black;">accept</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'mouse1'</span>,<span style="color: #008000;">self</span>.<span style="color: black;">printHello</span><span style="color: black;">&#41;</span><br />  <span style="color: #ff7700;font-weight:bold;">def</span> printHello<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Hello!'</span><br />h = Hello<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre>
<h2> <span class="mw-headline" id="Event_Handling_Functions">Event Handling Functions</span></h2>
<p>Events first go to a mechanism built into panda called the "Messenger." The messenger may accept or ignore events that it receives. If it accepts an event, then an event handler will be called. If ignored, then no handler will be called. 
</p><p>An object may accept an event an infinite number of times or accept it only once. If checking for an accept within the object listening to it, it should be prefixed with self. If the accept command occurs outside the class, then the variable the class is associated with should be used.
</p>
<pre class="python">myDirectObject.<span style="color: black;">accept</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Event Name'</span>,myDirectObjectMethod<span style="color: black;">&#41;</span><br />myDirectObject.<span style="color: black;">acceptOnce</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Event Name'</span>,myDirectObjectMethod<span style="color: black;">&#41;</span></pre>
<p>Specific events may be ignored, so that no message is sent. Also, all events coming from an object may be ignored.
</p>
<pre class="python">myDirectObject.<span style="color: black;">ignore</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Event Name'</span><span style="color: black;">&#41;</span><br />myDirectObject.<span style="color: black;">ignoreAll</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre>
<p>Finally, there are some useful utility functions for debugging. The messenger typically does not print out when every event occurs. Toggling verbose mode will make the messenger print every event it receives. Toggling it again will revert it to the default. A number of methods exist for checking to see what object is checking for what event, but the print method will show who is accepting each event. Also, if accepts keep changing to the point where it is too confusing, the clear method will start the messenger over with a clear dictionary.
</p>
<pre class="python">messenger.<span style="color: black;">toggleVerbose</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br /><span style="color: #ff7700;font-weight:bold;">print</span> messenger<br />messenger.<span style="color: black;">clear</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre>
<h2> <span class="mw-headline" id="Sending_Custom_Events">Sending Custom Events</span></h2>
<p>Custom events can be sent by the script using the code
</p>
<pre class="python">messenger.<span style="color: black;">send</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Event Name'</span><span style="color: black;">&#41;</span></pre>
<p>A list of parameters can optionally be sent to the event handler. Parameters defined in <code>accept()</code> are passed first, and then the parameters defined in <code>send()</code>.
for example this would print out "eggs sausage foo bar":
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">class</span> Test<span style="color: black;">&#40;</span>DirectObject<span style="color: black;">&#41;</span>:<br />    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />        <span style="color: #008000;">self</span>.<span style="color: black;">accept</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'spam'</span>,<span style="color: #008000;">self</span>.<span style="color: black;">OnSpam</span>,<span style="color: black;">&#91;</span><span style="color: #483d8b;">'eggs'</span>,<span style="color: #483d8b;">'sausage'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br />    <span style="color: #ff7700;font-weight:bold;">def</span> OnSpam<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>,a,b,c,d<span style="color: black;">&#41;</span>:<br />        <span style="color: #ff7700;font-weight:bold;">print</span> a,b,c,d<br />Test<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br />messenger.<span style="color: black;">send</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'spam'</span>,<span style="color: black;">&#91;</span><span style="color: #483d8b;">'foo'</span>,<span style="color: #483d8b;">'bar'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br />run<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre>
<h2> <span class="mw-headline" id="A_Note_on_Object_Management">A Note on Object Management</span></h2>
<p>When a DirectObject accepts an event, the messenger retains a reference to that DirectObject. To ensure that objects that are no longer needed are properly disposed of, they must ignore any messages they are accepting.
</p><p>For example, the following code may not do what you expect:
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">import</span> direct.<span style="color: black;">directbase</span>.<span style="color: black;">DirectStart</span><br /><span style="color: #ff7700;font-weight:bold;">from</span> direct.<span style="color: black;">showbase</span> <span style="color: #ff7700;font-weight:bold;">import</span> DirectObject<br /><span style="color: #ff7700;font-weight:bold;">from</span> panda3d.<span style="color: black;">core</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #66cc66;">*</span><br />&#160;<br /><span style="color: #ff7700;font-weight:bold;">class</span> Test<span style="color: black;">&#40;</span>DirectObject.<span style="color: black;">DirectObject</span><span style="color: black;">&#41;</span>:<br />    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />        <span style="color: #008000;">self</span>.<span style="color: black;">accept</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;FireZeMissiles&quot;</span>,<span style="color: #008000;">self</span>._fireMissiles<span style="color: black;">&#41;</span><br />&#160;<br />    <span style="color: #ff7700;font-weight:bold;">def</span> _fireMissiles<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Missiles fired! Oh noes!&quot;</span><br />&#160;<br />&#160;<br />foo=Test<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># create our test object</span><br />&#160;<br /><span style="color: #ff7700;font-weight:bold;">del</span> foo    <span style="color: #808080; font-style: italic;"># get rid of our test object</span><br />&#160;<br />messenger.<span style="color: black;">send</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;FireZeMissiles&quot;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># oops! Why did those missiles fire?</span><br />run<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre> 
<p>Try the example above, and you'll find that the missiles fire even though the object that would handle the event had been deleted.
</p><p>One solution (patterned after other parts of the Panda3d architecture) is to define a "destroy" method for any custom classes you create, which calls "ignoreAll" to unregister from the event-handler system.
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">import</span> direct.<span style="color: black;">directbase</span>.<span style="color: black;">DirectStart</span><br /><span style="color: #ff7700;font-weight:bold;">from</span> direct.<span style="color: black;">showbase</span> <span style="color: #ff7700;font-weight:bold;">import</span> DirectObject<br /><span style="color: #ff7700;font-weight:bold;">from</span> panda3d.<span style="color: black;">core</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #66cc66;">*</span><br />&#160;<br /><span style="color: #ff7700;font-weight:bold;">class</span> Test<span style="color: black;">&#40;</span>DirectObject.<span style="color: black;">DirectObject</span><span style="color: black;">&#41;</span>:<br />    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />        <span style="color: #008000;">self</span>.<span style="color: black;">accept</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;FireZeMissiles&quot;</span>,<span style="color: #008000;">self</span>._fireMissiles<span style="color: black;">&#41;</span><br />&#160;<br />    <span style="color: #ff7700;font-weight:bold;">def</span> _fireMissiles<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Missiles fired! Oh noes!&quot;</span><br />&#160;<br />    <span style="color: #808080; font-style: italic;"># function to get rid of me</span><br />    <span style="color: #ff7700;font-weight:bold;">def</span> destroy<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:<br />        <span style="color: #008000;">self</span>.<span style="color: black;">ignoreAll</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <br />&#160;<br />&#160;<br />foo=Test<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># create our test object</span><br />&#160;<br />foo.<span style="color: black;">destroy</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>    <span style="color: #808080; font-style: italic;"># get rid of our test object</span><br /><span style="color: #ff7700;font-weight:bold;">del</span> foo<br />&#160;<br />messenger.<span style="color: black;">send</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;FireZeMissiles&quot;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># No missiles fire</span><br />run<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre>

<!-- 
NewPP limit report
Preprocessor node count: 118/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_manual:pcache:idhash:1019-0!*!0!!en!*!* and timestamp 20130413153011 -->
</div><div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Task_Chains.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Main_Loop.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div id=legal>&copy; Carnegie Mellon University 2010</div></td></tr></table></td><td id=borderright></td></tr></table></td><td id=borderright></td></tr></table></body></html>