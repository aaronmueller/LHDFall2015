<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

  <head>
    <title>Simulating the Physics World - Panda3D Manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="style.css" type="text/css"><link rel="shortcut icon" href="favicon.ico">    <meta name="keywords" content="Panda3D, Panda, 3D, Python, graphics, free, game, engine, game rendering engine, simulation, open source, free download, Disney, ETC, Entertainment Technology Center, open-source">
    <meta name="description" content="Free open source 3D game and simulation engine developed by Disney and maintained by Carnegie Mellon University\'s Entertainment Technology Center">
    </head>
    <body>
<table width=960 cellpadding=0 cellspacing=0 id=main align=center>
<tr>
<td id=borderleft></td>
<td id=maincenter valign=top>
<tr><td id=pcontent valign=top><h2>Panda3D Manual: Simulating the Physics World</h2>
<div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Worlds,_Bodies_and_Masses.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Attaching_Bodies_using_Joints.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div class='wikicontent' id='wikicontentid'><h2> <span class="mw-headline" id="Simulating_the_physics_scene">Simulating the physics scene</span></h2>
<p>Now, we've only had some theory so far, but haven't seen any simulation yet. To simulate, we will need to keep calling the <code>quick_step(stepSize)</code> function on the OdeWorld instance. stepSize is how much time should be simulated in one step. To get the most stable simulation, it is recommended that the stepSize be kept constant.
</p><p>The problem with using the delta time of a task to step the simulation is that the time between tasks might not be consistent. To get around this, a deltaTime accumulator is used to figure out how many steps must be taken. When a step is performed, the world is iterated a few times, you can specify how much times the world is being iterated by calling the <code>set_quick_step_num_iterations(num)</code> function on the OdeWorld instance.
</p><p>Here's a small example showing a simple simulation showing an iron ball falling from a ridge:


</p>
<pre class="cpp"><span style="color: #666666;">// To keep the C++ samples short, we assume a running Panda</span><br /><span style="color: #666666;">// environment, with a &quot;framework&quot;, &quot;window&quot;, &quot;camera&quot; and &quot;taskMgr&quot; variables</span><br /><span style="color: #666666;">// in the global scope. Likewise, only the includes relevant to this chapter</span><br /><span style="color: #666666;">// are shown. Check the beginning of the manual for a tutorial on making a</span><br /><span style="color: #666666;">// full Panda3D C++ app.</span><br /><span style="color: #666666;">// Sample entry point: simulation()</span><br />&#160;<br /><span style="color: #339900;">#include &quot;odeWorld.h&quot;</span><br /><span style="color: #339900;">#include &quot;odeBody.h&quot;</span><br /><span style="color: #339900;">#include &quot;odeMass.h&quot;</span><br />&#160;<br />OdeBody <span style="color: #000040;">*</span>body<span style="color: #008080;">;</span><br />OdeWorld world<span style="color: #008080;">;</span><br />NodePath sphere<span style="color: #008080;">;</span><br />PT<span style="color: #008000;">&#40;</span>ClockObject<span style="color: #008000;">&#41;</span> globalClock <span style="color: #000080;">=</span> ClockObject<span style="color: #008080;">::</span><span style="color: #000000;">get_global_clock</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br /><span style="color: #666666;">// Create an accumulator to track the time since the sim</span><br /><span style="color: #666666;">// has been running</span><br /><span style="color: #0000ff;">float</span> deltaTimeAccumulator <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>.0f<span style="color: #008080;">;</span><br />&#160;<br /><span style="color: #666666;">// This stepSize makes the simulation run at 90 frames per second</span><br /><span style="color: #0000ff;">float</span> stepSize <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>.0f <span style="color: #000040;">/</span> <span style="color: #0000dd;">90</span>.0f<span style="color: #008080;">;</span><br />&#160;<br />AsyncTask<span style="color: #008080;">::</span><span style="color: #000000;">DoneStatus</span> simulationTask <span style="color: #008000;">&#40;</span>GenericAsyncTask<span style="color: #000040;">*</span> task, <span style="color: #0000ff;">void</span><span style="color: #000040;">*</span> data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br /><span style="color: #0000ff;">void</span> simulation<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span><br />  <span style="color: #666666;">// Load the cube where the ball will fall from</span><br />  NodePath cube window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>load_model<span style="color: #008000;">&#40;</span>framework.<span style="color: #000000;">get_models</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>, <span style="color: #FF0000;">&quot;models/box&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  cube.<span style="color: #000000;">reparent_to</span><span style="color: #008000;">&#40;</span>window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_render<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  cube.<span style="color: #000000;">set_scale</span><span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0.25</span>, <span style="color: #0000dd;">0.25</span>, <span style="color: #0000dd;">0.25</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  cube.<span style="color: #000000;">set_pos</span><span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br />  <span style="color: #666666;">// Load the smiley model which will act as our iron ball</span><br />  sphere <span style="color: #000080;">=</span> window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>load_model<span style="color: #008000;">&#40;</span>framework.<span style="color: #000000;">get_models</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>, <span style="color: #FF0000;">&quot;models/smiley&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  sphere.<span style="color: #000000;">reparent_to</span><span style="color: #008000;">&#40;</span>window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_render<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  sphere.<span style="color: #000000;">set_scale</span><span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0.25</span>, <span style="color: #0000dd;">0.25</span>, <span style="color: #0000dd;">0.25</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  sphere.<span style="color: #000000;">set_pos</span><span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">1</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br />  <span style="color: #666666;">// Setup our physics world and the body</span><br />  world.<span style="color: #000000;">set_gravity</span><span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">-9.81</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  body <span style="color: #000080;">=</span> <span style="color: #0000dd;">new</span> OdeBody<span style="color: #008000;">&#40;</span>world<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  OdeMass M <span style="color: #000080;">=</span> OdeMass<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  M.<span style="color: #000000;">set_sphere</span><span style="color: #008000;">&#40;</span><span style="color: #0000dd;">7874</span>, <span style="color: #0000dd;">1.0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  body<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>set_mass<span style="color: #008000;">&#40;</span>M<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  body<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>set_position<span style="color: #008000;">&#40;</span>sphere.<span style="color: #000000;">get_pos</span><span style="color: #008000;">&#40;</span>window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_render<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  body<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>set_quaternion<span style="color: #008000;">&#40;</span>sphere.<span style="color: #000000;">get_quat</span><span style="color: #008000;">&#40;</span>window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_render<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br />  <span style="color: #666666;">// Set the camera position</span><br />  camera.<span style="color: #000000;">set_pos</span> <span style="color: #008000;">&#40;</span><span style="color: #0000dd;">80</span>, <span style="color: #0000dd;">-20</span>, <span style="color: #0000dd;">40</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  camera.<span style="color: #000000;">look_at</span> <span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br />  PT<span style="color: #008000;">&#40;</span>GenericAsyncTask<span style="color: #008000;">&#41;</span> simulationTaskObject <span style="color: #000080;">=</span><br />    <span style="color: #0000dd;">new</span> GenericAsyncTask<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;startup task&quot;</span>, <span style="color: #000040;">&amp;</span>simulationTask, <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">void</span><span style="color: #000040;">*</span><span style="color: #008000;">&#41;</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  simulationTaskObject<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>set_delay<span style="color: #008000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  taskMgr<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>add<span style="color: #008000;">&#40;</span>simulationTaskObject<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br /><span style="color: #008000;">&#125;</span><br />&#160;<br /><span style="color: #666666;">// The task for our simulation</span><br />AsyncTask<span style="color: #008080;">::</span><span style="color: #000000;">DoneStatus</span> simulationTask <span style="color: #008000;">&#40;</span>GenericAsyncTask<span style="color: #000040;">*</span> task, <span style="color: #0000ff;">void</span><span style="color: #000040;">*</span> data<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span><br />  <span style="color: #666666;">// Set the force on the body to push it off the ridge</span><br />  body<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>set_force<span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span>, min<span style="color: #008000;">&#40;</span><span style="color: #0000dd;">pow</span><span style="color: #008000;">&#40;</span>task<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_elapsed_time<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>,<span style="color: #0000dd;">4</span><span style="color: #008000;">&#41;</span> <span style="color: #000040;">*</span> <span style="color: #0000dd;">500000</span> <span style="color: #000040;">-</span> <span style="color: #0000dd;">500000</span>, <span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span>, <span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  <span style="color: #666666;">// Add the deltaTime for the task to the accumulator</span><br />  deltaTimeAccumulator <span style="color: #000040;">+</span><span style="color: #000080;">=</span> globalClock<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_dt<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  <span style="color: #0000ff;">while</span> <span style="color: #008000;">&#40;</span>deltaTimeAccumulator <span style="color: #000080;">&gt;</span> stepSize <span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span><br />    <span style="color: #666666;">// Remove a stepSize from the accumulator until</span><br />    <span style="color: #666666;">// the accumulated time is less than the stepsize</span><br />    deltaTimeAccumulator <span style="color: #000040;">-</span><span style="color: #000080;">=</span> stepSize<span style="color: #008080;">;</span><br />    <span style="color: #666666;">// Step the simulation</span><br />    world.<span style="color: #000000;">quick_step</span><span style="color: #008000;">&#40;</span>stepSize<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  <span style="color: #008000;">&#125;</span><br />  <span style="color: #666666;">// set the new positions</span><br />  sphere.<span style="color: #000000;">set_pos_quat</span><span style="color: #008000;">&#40;</span>window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_render<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>,<br />    body<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_position<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>, body<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_quaternion<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  <span style="color: #0000ff;">return</span> AsyncTask<span style="color: #008080;">::</span><span style="color: #000000;">DS_cont</span><span style="color: #008080;">;</span><br /><span style="color: #008000;">&#125;</span></pre>
<p>
</p>
<h2> <span class="mw-headline" id="Incomplete_Section">Incomplete Section</span></h2>
<p>Note: this section is incomplete.  It will be updated soon.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 38/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_manual:pcache:idhash:2286-0!*!*!!*!*!* and timestamp 20130413233343 -->
</div><div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Worlds,_Bodies_and_Masses.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Attaching_Bodies_using_Joints.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div id=legal>&copy; Carnegie Mellon University 2010</div></td></tr></table></td><td id=borderright></td></tr></table></td><td id=borderright></td></tr></table></body></html>