<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

  <head>
    <title>Woodgrain Example - Panda3D Manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="style.css" type="text/css"><link rel="shortcut icon" href="favicon.ico">    <meta name="keywords" content="Panda3D, Panda, 3D, Python, graphics, free, game, engine, game rendering engine, simulation, open source, free download, Disney, ETC, Entertainment Technology Center, open-source">
    <meta name="description" content="Free open source 3D game and simulation engine developed by Disney and maintained by Carnegie Mellon University\'s Entertainment Technology Center">
    </head>
    <body>
<table width=960 cellpadding=0 cellspacing=0 id=main align=center>
<tr>
<td id=borderleft></td>
<td id=maincenter valign=top>
<tr><td id=pcontent valign=top><h2>Panda3D Manual: Woodgrain Example</h2>
<div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;</td>
              <td width="70px" align="center"></td>
              <td width="70px" align="right">&nbsp;&nbsp;</td>
              </tr></table></div><div class='wikicontent' id='wikicontentid'><br><small><i>This page is not in the table of contents.</i></small><br><p>The following program will generate and write out a 3-D texture to simulate woodgrain:
</p>
<pre class="python"><span style="color: #ff7700;font-weight:bold;">from</span> direct.<span style="color: black;">directbase</span>.<span style="color: black;">DirectStart</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #66cc66;">*</span><br /><span style="color: #ff7700;font-weight:bold;">from</span> panda3d.<span style="color: black;">core</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #66cc66;">*</span><br /><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">math</span><br />&#160;<br /><span style="color: #808080; font-style: italic;"># These constants define the RGB colors of the light and dark bands in</span><br /><span style="color: #808080; font-style: italic;"># the woodgrain.</span><br />lightGrain = <span style="color: black;">&#40;</span><span style="color: #ff4500;">0.72</span>, <span style="color: #ff4500;">0.72</span>, <span style="color: #ff4500;">0.45</span><span style="color: black;">&#41;</span><br />darkGrain = <span style="color: black;">&#40;</span><span style="color: #ff4500;">0.49</span>, <span style="color: #ff4500;">0.33</span>, <span style="color: #ff4500;">0.11</span><span style="color: black;">&#41;</span><br />&#160;<br /><span style="color: #ff7700;font-weight:bold;">def</span> chooseGrain<span style="color: black;">&#40;</span>p, xi, yi, radius<span style="color: black;">&#41;</span>:<br />    <span style="color: #483d8b;">&quot;&quot;&quot; Applies the appropriate color to pixel (xi, yi), based on<br />    radius, the computed distance from the center of the trunk. &quot;&quot;&quot;</span><br />&#160;<br />    <span style="color: #808080; font-style: italic;"># Get the fractional part of radius.</span><br />    t = radius - <span style="color: #dc143c;">math</span>.<span style="color: black;">floor</span><span style="color: black;">&#40;</span>radius<span style="color: black;">&#41;</span><br />&#160;<br />    <span style="color: #808080; font-style: italic;"># Now t ranges from 0 to 1.  Make it see-saw from 0 to 1 and back.</span><br />    t = <span style="color: #008000;">abs</span><span style="color: black;">&#40;</span>t - <span style="color: #ff4500;">0.5</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">2</span><br />&#160;<br />    <span style="color: #808080; font-style: italic;"># Now interpolate colors.</span><br />    p.<span style="color: black;">setXel</span><span style="color: black;">&#40;</span>xi, yi,<br />             lightGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> + t <span style="color: #66cc66;">*</span> <span style="color: black;">&#40;</span>darkGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> - lightGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,<br />             lightGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span> + t <span style="color: #66cc66;">*</span> <span style="color: black;">&#40;</span>darkGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span> - lightGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,<br />             lightGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span> + t <span style="color: #66cc66;">*</span> <span style="color: black;">&#40;</span>darkGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span> - lightGrain<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br />&#160;<br /><span style="color: #ff7700;font-weight:bold;">def</span> calcRadius<span style="color: black;">&#40;</span>xn, yn, x, y, z, noiseAmp<span style="color: black;">&#41;</span>:<br />    <span style="color: #483d8b;">&quot;&quot;&quot; Calculates radius, the distance from the center of the trunk,<br />    for the 3-d point (x, y, z).  The point is perturbed with noise to<br />    make the woodgrain seem more organic. &quot;&quot;&quot;</span><br />&#160;<br />    xp = x + xn.<span style="color: black;">noise</span><span style="color: black;">&#40;</span>x, y, z<span style="color: black;">&#41;</span> <span style="color: #66cc66;">*</span> noiseAmp<br />    yp = y + yn.<span style="color: black;">noise</span><span style="color: black;">&#40;</span>x, y, z<span style="color: black;">&#41;</span> <span style="color: #66cc66;">*</span> noiseAmp<br />&#160;<br />    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">math</span>.<span style="color: black;">sqrt</span><span style="color: black;">&#40;</span>xp <span style="color: #66cc66;">*</span> xp + yp <span style="color: #66cc66;">*</span> yp<span style="color: black;">&#41;</span><br />&#160;<br /><span style="color: #ff7700;font-weight:bold;">def</span> makeWoodgrain<span style="color: black;">&#40;</span>texSize, texZSize, noiseScale, noiseZScale,<br />                  noiseAmp, ringScale<span style="color: black;">&#41;</span>:<br />&#160;<br />    <span style="color: #483d8b;">&quot;&quot;&quot; Generate a 3-D texture of size texSize x texSize x texZSize<br />    that suggests woodgrain, with the grain running along the Z (W)<br />    direction.  Since there is not as much detail parallel to the<br />    grain as across it, the texture does not need to be as large in<br />    the Z dimension as in the other two dimensions.<br />&#160;<br />    The woodgrain shape is perturbed with Perlin noise to make it more<br />    organic.  The parameters noiseScale and noiseZScale controls the<br />    frequency of the noise; larger numbers make smoother rings.  The<br />    parameter noiseAmp controls the effect of the noise; larger<br />    numbers make more dramatic distortions.<br />&#160;<br />    ringScale controls the number of rings visible in the cross<br />    section of the texture.  A larger number makes more, denser rings.<br />    &quot;&quot;&quot;</span><br />&#160;<br />    <span style="color: #808080; font-style: italic;"># First, create the two PerlinNoise objects to perturb the rings</span><br />    <span style="color: #808080; font-style: italic;"># in two dimensions.  This class is defined in Panda3D.</span><br />    xn = PerlinNoise3<span style="color: black;">&#40;</span>noiseScale, noiseScale, noiseZScale<span style="color: black;">&#41;</span><br />    yn = PerlinNoise3<span style="color: black;">&#40;</span>noiseScale, noiseScale, noiseZScale<span style="color: black;">&#41;</span><br />&#160;<br />    <span style="color: #808080; font-style: italic;"># Start by creating a empty 3-D texture.</span><br />    tex = Texture<span style="color: black;">&#40;</span><span style="color: #483d8b;">'woodgrain'</span><span style="color: black;">&#41;</span><br />    tex.<span style="color: black;">setup3dTexture</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br />&#160;<br />    <span style="color: #ff7700;font-weight:bold;">for</span> zi <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>texZSize<span style="color: black;">&#41;</span>:<br />        z = <span style="color: #008000;">float</span><span style="color: black;">&#40;</span>zi<span style="color: black;">&#41;</span> / <span style="color: #008000;">float</span><span style="color: black;">&#40;</span>texZSize - <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> - <span style="color: #ff4500;">0.5</span><br />&#160;<br />        <span style="color: #808080; font-style: italic;"># Walk through the Z slices of the texture one at a time.  For</span><br />        <span style="color: #808080; font-style: italic;"># each slice, we create a PNMImage, very much as if we were</span><br />        <span style="color: #808080; font-style: italic;"># reading the texture from disk.</span><br />        <span style="color: #ff7700;font-weight:bold;">print</span> zi<br />        p = PNMImage<span style="color: black;">&#40;</span>texSize, texSize<span style="color: black;">&#41;</span><br />&#160;<br />        <span style="color: #808080; font-style: italic;"># But instead of reading the PNMImage, we fill it in with the</span><br />        <span style="color: #808080; font-style: italic;"># ring pattern.</span><br />        <span style="color: #ff7700;font-weight:bold;">for</span> yi <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>texSize<span style="color: black;">&#41;</span>:<br />            y = <span style="color: #008000;">float</span><span style="color: black;">&#40;</span>yi<span style="color: black;">&#41;</span> / <span style="color: #008000;">float</span><span style="color: black;">&#40;</span>texSize - <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> - <span style="color: #ff4500;">0.5</span><br />            <span style="color: #ff7700;font-weight:bold;">for</span> xi <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>texSize<span style="color: black;">&#41;</span>:<br />                x = <span style="color: #008000;">float</span><span style="color: black;">&#40;</span>xi<span style="color: black;">&#41;</span> / <span style="color: #008000;">float</span><span style="color: black;">&#40;</span>texSize - <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> - <span style="color: #ff4500;">0.5</span><br />&#160;<br />                radius = calcRadius<span style="color: black;">&#40;</span>xn, yn, x, y, z, noiseAmp<span style="color: black;">&#41;</span><br />                chooseGrain<span style="color: black;">&#40;</span>p, xi, yi, radius <span style="color: #66cc66;">*</span> ringScale<span style="color: black;">&#41;</span><br />&#160;<br />        <span style="color: #808080; font-style: italic;"># Now load the current slice into the texture.</span><br />        tex.<span style="color: black;">load</span><span style="color: black;">&#40;</span>p, zi, <span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span><br />&#160;<br />    <span style="color: #ff7700;font-weight:bold;">return</span> tex<br />&#160;<br /><span style="color: #808080; font-style: italic;"># Create a 3-D texture.</span><br />tex = makeWoodgrain<span style="color: black;">&#40;</span>texSize = <span style="color: #ff4500;">256</span>, texZSize = <span style="color: #ff4500;">8</span>, noiseScale = <span style="color: #ff4500;">0.4</span>,<br />                    noiseZScale = <span style="color: #ff4500;">0.8</span>, noiseAmp = <span style="color: #ff4500;">0.12</span>, ringScale = <span style="color: #ff4500;">40</span><span style="color: black;">&#41;</span><br />&#160;<br /><span style="color: #808080; font-style: italic;"># Write out the texture.  This will generate woodgrain_0.png,</span><br /><span style="color: #808080; font-style: italic;"># woodgrain_1.png, and so on, in the current directory.</span><br />tex.<span style="color: black;">write</span><span style="color: black;">&#40;</span>Filename<span style="color: black;">&#40;</span><span style="color: #483d8b;">'woodgrain_#.png'</span><span style="color: black;">&#41;</span>, <span style="color: #ff4500;">0</span>, <span style="color: #ff4500;">0</span>, <span style="color: #008000;">True</span>, <span style="color: #008000;">False</span><span style="color: black;">&#41;</span></pre>
<p>The resulting images look like this:
</p><p><a href="File%253AWoodgrain_0.jpg.html" class="image"><img alt="Woodgrain 0.jpg" src="Woodgrain_0.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_1.jpg.html" class="image"><img alt="Woodgrain 1.jpg" src="Woodgrain_1.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_2.jpg.html" class="image"><img alt="Woodgrain 2.jpg" src="Woodgrain_2.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_3.jpg.html" class="image"><img alt="Woodgrain 3.jpg" src="Woodgrain_3.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_4.jpg.html" class="image"><img alt="Woodgrain 4.jpg" src="Woodgrain_4.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_5.jpg.html" class="image"><img alt="Woodgrain 5.jpg" src="Woodgrain_5.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_6.jpg.html" class="image"><img alt="Woodgrain 6.jpg" src="Woodgrain_6.jpg" width="256" height="256" /></a>
<a href="File%253AWoodgrain_7.jpg.html" class="image"><img alt="Woodgrain 7.jpg" src="Woodgrain_7.jpg" width="256" height="256" /></a>
</p><p><br />
To get consistent (over multiple runs of the programm) values from the PerlinNoise functions a seed value&#160;!= 0 has to be used, seed values equal to 0 will randomize it<br />
The table_size is 256 by default.<br />
<br />
PerlinNoise3( scaleX, scaleY, scaleZ, table_size, seed)<br />
PerlinNoise2( scaleX, scaleY, table_size, seed)<br />
PerlinNoise( table_size, seed )<br />
</p>
<!-- 
NewPP limit report
Preprocessor node count: 4/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_manual:pcache:idhash:1202-0!*!*!*!*!2!* and timestamp 20130413213622 -->
</div><div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;</td>
              <td width="70px" align="center"></td>
              <td width="70px" align="right">&nbsp;&nbsp;</td>
              </tr></table></div><div id=legal>&copy; Carnegie Mellon University 2010</div></td></tr></table></td><td id=borderright></td></tr></table></td><td id=borderright></td></tr></table></body></html>