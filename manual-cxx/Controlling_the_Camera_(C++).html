<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

  <head>
    <title>Controlling the Camera (CXX) - Panda3D Manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="style.css" type="text/css"><link rel="shortcut icon" href="favicon.ico">    <meta name="keywords" content="Panda3D, Panda, 3D, Python, graphics, free, game, engine, game rendering engine, simulation, open source, free download, Disney, ETC, Entertainment Technology Center, open-source">
    <meta name="description" content="Free open source 3D game and simulation engine developed by Disney and maintained by Carnegie Mellon University\'s Entertainment Technology Center">
    </head>
    <body>
<table width=960 cellpadding=0 cellspacing=0 id=main align=center>
<tr>
<td id=borderleft></td>
<td id=maincenter valign=top>
<tr><td id=pcontent valign=top><h2>Panda3D Manual: Controlling the Camera (CXX)</h2>
<div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;</td>
              <td width="70px" align="center"></td>
              <td width="70px" align="right">&nbsp;&nbsp;</td>
              </tr></table></div><div class='wikicontent' id='wikicontentid'><br><small><i>This page is not in the table of contents.</i></small><br><p>Panda3D comes with a function that enables you to move
the camera using the mouse. To use this, insert:
</p>
<pre class="codeblock">
window-&gt;setup_trackball();
</pre>
<p>just before your call to the main loop.
The keys to navigate using this function are:
</p>
<ul>
<li>Left Button: pan left and right
<li>Right Button: move forwards and backwards
<li>Middle Button: rotate around the origin of the application
<li>Right and Middle Buttons: roll the point of view around the view axis
</ul>
<p>Go ahead and try this camera control system.  The
problem with this camera control system is that it is sometimes
awkward, it is not always easy to get the camera pointed in the
direction we want.
</p><p>Instead, we want to have our camera position changed every frame. Because there is no basic implementation for <a href="Tasks.html" title="Tasks">tasks</a> in C++ (yet), we have to write the main loop by ourselves. We can do this by making an infinite loop, in which the camera position gets updated and the function <code>framework.do_frame</code> gets called. All this function does is rendering the current frame. It returns false if the window is terminated, and the main loop should stop.
Update your code as follows:
</p>
<pre class="codeblock">
#include &quot;pandaFramework.h&quot;
#include &quot;pandaSystem.h&quot;

PandaFramework framework;

int main(int argc, char *argv[]) {
    //open a new window framework
  framework.open_framework(argc, argv);
    //set the window title to My Panda3D Window
  framework.set_window_title(&quot;My Panda3D Window&quot;);
    //open the window
  WindowFramework *window = framework.open_window();
  NodePath cam = window-&gt;get_camera_group(); //get the camera and store it
    //load the environment model
  NodePath environ = window-&gt;load_model(framework.get_models(),&quot;models/environment&quot;);
  environ.reparent_to(window-&gt;get_render());
  environ.set_scale(0.25,0.25,0.25);
  environ.set_pos(-8,42,0);
    //do the main loop:
  ClockObject* clock; //create a clock object for time measurement
  clock=ClockObject::get_global_clock();
  Thread *current_thread = Thread::get_current_thread();
  while(framework.do_frame(current_thread)) {
    double time = clock-&gt;get_real_time(); //get the time in seconds
    double angledegrees = time * 6.0; //the angle of the camera in degrees
    double angleradians = angledegrees * (3.14 / 180.0); //in radians
    cam.set_pos(20*sin(angleradians),-20.0*cos(angleradians),3); //set the position
    cam.set_hpr(angledegrees, 0, 0); //set the hpr
  }
  //close the window framework
  framework.close_framework();
  return (0);
}

</pre>
<p><b>Note:</b> It is not possible to update the camera's position while the trackball is enabled. To have this code work, you must <b>not</b> call the <code>setup_trackball()</code> function.
</p><p>The code in our home-made main loop calculates the desired position of
the camera based on how much time has elapsed. To get this time, we use Panda3D's global ClockObject. (It is sometimes convenient
to put these calculations in a separate function, but since we only have one
task now, it's not much of a problem.) The camera rotates 6
degrees every second.  The first two lines compute the desired
orientation of the camera, first in degrees, then in radians.  The <code>set_pos</code> call actually sets the position of the camera.
The <code>set_hpr</code> call actually sets the orientation.
</p><p>The camera should no longer be underground, and
furthermore, the camera should now be rotating about the clearing:
</p><p><a href="File%253ATutorial2.jpg.html" class="image"><img alt="Tutorial2.jpg" src="Tutorial2.jpg" width="400" height="300" /></a>
</p>
<!-- 
NewPP limit report
Preprocessor node count: 19/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_manual:pcache:idhash:2089-0!*!0!*!*!2!* and timestamp 20130413213656 -->
</div><div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;</td>
              <td width="70px" align="center"></td>
              <td width="70px" align="right">&nbsp;&nbsp;</td>
              </tr></table></div><div id=legal>&copy; Carnegie Mellon University 2010</div></td></tr></table></td><td id=borderright></td></tr></table></td><td id=borderright></td></tr></table></body></html>