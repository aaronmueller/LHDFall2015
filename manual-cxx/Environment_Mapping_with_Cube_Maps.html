<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

  <head>
    <title>Environment Mapping with Cube Maps - Panda3D Manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="style.css" type="text/css"><link rel="shortcut icon" href="favicon.ico">    <meta name="keywords" content="Panda3D, Panda, 3D, Python, graphics, free, game, engine, game rendering engine, simulation, open source, free download, Disney, ETC, Entertainment Technology Center, open-source">
    <meta name="description" content="Free open source 3D game and simulation engine developed by Disney and maintained by Carnegie Mellon University\'s Entertainment Technology Center">
    </head>
    <body>
<table width=960 cellpadding=0 cellspacing=0 id=main align=center>
<tr>
<td id=borderleft></td>
<td id=maincenter valign=top>
<tr><td id=pcontent valign=top><h2>Panda3D Manual: Environment Mapping with Cube Maps</h2>
<div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Cube_Maps.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Automatic_Texture_Animation.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div class='wikicontent' id='wikicontentid'><p>Although there are other applications for cube maps, one very common
use of cube maps is as an <b>environment map</b>, similar to
<a href="Simple_Environment_Mapping.html" title="Simple Environment Mapping">sphere mapping</a>.  In fact, it works very
much the same as sphere mapping.
</p><p>Just as with a sphere map, you can have Panda3D generate a cube map
for you:
</p>
<pre class="python">scene = loader.<span style="color: black;">loadModel</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'bvw-f2004--streetscene/street-scene.egg'</span><span style="color: black;">&#41;</span><br />scene.<span style="color: black;">reparentTo</span><span style="color: black;">&#40;</span>render<span style="color: black;">&#41;</span><br />scene.<span style="color: black;">setZ</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">-2</span><span style="color: black;">&#41;</span><br />base.<span style="color: black;">saveCubeMap</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'streetscene_cube_#.jpg'</span>, size = <span style="color: #ff4500;">256</span><span style="color: black;">&#41;</span></pre>
<p><a href="Sample_Cube_Map.html" title="Sample Cube Map">Click here</a> to see the six images generated by the above sample code.
</p><p>With the cube map saved out as above, you could apply it as an
environment map to the teapot like this:
</p>
<pre class="python">tex = loader.<span style="color: black;">loadCubeMap</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'streetscene_cube_#.jpg'</span><span style="color: black;">&#41;</span><br />teapot.<span style="color: black;">setTexGen</span><span style="color: black;">&#40;</span>TextureStage.<span style="color: black;">getDefault</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, TexGenAttrib.<span style="color: black;">MEyeCubeMap</span><span style="color: black;">&#41;</span><br />teapot.<span style="color: black;">setTexture</span><span style="color: black;">&#40;</span>tex<span style="color: black;">&#41;</span></pre>
<p>And the result looks very similar to the sphere map:
</p><p><a href="File%253ACubemap_teapot.jpg.html" class="image" title="The cube map on a teapot."><img alt="The cube map on a teapot." src="Cubemap_teapot.jpg" width="400" height="300" /></a>
</p><p>In fact, it looks so similar that one might wonder why we bothered.
So far, a cube map looks pretty similar to a sphere map, except that
it consumes six times the texture memory.  Hardly impressive.
</p><p>But as we mentioned <a href="Simple_Environment_Mapping.html" title="Simple Environment Mapping">earlier</a>, there are
two problems with sphere maps that cube maps can solve.  One of these
problems is that the point-of-view is permanently baked into the
sphere map.  Cube maps don't necessarily have the same problem.  In
fact, we can solve it with one simple variation:
</p>
<pre class="python">tex = loader.<span style="color: black;">loadCubeMap</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'streetscene_cube_#.jpg'</span><span style="color: black;">&#41;</span><br />teapot.<span style="color: black;">setTexGen</span><span style="color: black;">&#40;</span>TextureStage.<span style="color: black;">getDefault</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, TexGenAttrib.<span style="color: black;">MWorldCubeMap</span><span style="color: black;">&#41;</span><br />teapot.<span style="color: black;">setTexture</span><span style="color: black;">&#40;</span>tex<span style="color: black;">&#41;</span></pre>
<p>By changing <code>MEyeCubeMap</code> to <code>MWorldCubeMap</code>, we
have indicated that we would like this cube map to vary its
point-of-view as the camera moves.  Now the reflected environment will
vary according to the direction we are looking at it, so that it shows what is behind the camera at runtime, instead of always showing
the area behind the camera when the cube map was generated, as a
sphere map must do.  In order for this to work properly, you should
ensure that your camera is unrotated (that is, <code>setHpr(0, 0,
0)</code>) when you generate the cube map initially.
</p><p>Even with MWorldCubeMap, though, the image is still generated ahead of time, so the reflection doesn't <i>actually</i> show what is behind the camera at runtime.  It just uses the current camera direction to figure out what part of the reflection image to show.
</p><p>However, you can make a cube map that truly does reflect dynamic objects in the scene, by rendering a <a href="Dynamic_Cube_Maps.html" title="Dynamic Cube Maps">dynamic cube map</a>.  This will be discussed in the next section.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 19/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_manual:pcache:idhash:1231-0!*!0!*!*!2!* and timestamp 20130413191141 -->
</div><div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Cube_Maps.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Automatic_Texture_Animation.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div id=legal>&copy; Carnegie Mellon University 2010</div></td></tr></table></td><td id=borderright></td></tr></table></td><td id=borderright></td></tr></table></body></html>