<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

  <head>
    <title>Mouse Support - Panda3D Manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="style.css" type="text/css"><link rel="shortcut icon" href="favicon.ico">    <meta name="keywords" content="Panda3D, Panda, 3D, Python, graphics, free, game, engine, game rendering engine, simulation, open source, free download, Disney, ETC, Entertainment Technology Center, open-source">
    <meta name="description" content="Free open source 3D game and simulation engine developed by Disney and maintained by Carnegie Mellon University\'s Entertainment Technology Center">
    </head>
    <body>
<table width=960 cellpadding=0 cellspacing=0 id=main align=center>
<tr>
<td id=borderleft></td>
<td id=maincenter valign=top>
<tr><td id=pcontent valign=top><h2>Panda3D Manual: Mouse Support</h2>
<div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Keyboard_Support.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Joystick_Support.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div class='wikicontent' id='wikicontentid'><p>Panda3D has mouse support built in.


In C++, you need to do the following if you want the mouse to control the camera:
</p>
<pre class="cpp">window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>setup_trackball<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span></pre>
<p>You don't need to do this to enable the mouse itself, only to enable a task that drives the camera around. You can still get the position of the mouse, as well as the mouse clicks, even if you don't enable this "trackball mode".

</p><p>To get the position:
</p>

<pre class="cpp"><span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>mouseWatcher<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>has_mouse<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span><br />  <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span><br />    <span style="color: #0000ff;">int</span> x <span style="color: #000080;">=</span> window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_pointer<span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span>.<span style="color: #000000;">get_x</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />    <span style="color: #0000ff;">int</span> y <span style="color: #000080;">=</span> window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_pointer<span style="color: #008000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span>.<span style="color: #000000;">get_y</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />  <span style="color: #008000;">&#125;</span><br /><span style="color: #008000;">&#125;</span></pre>
<p>The mouse clicks generate "events." To understand what events are, and how to process them, you will need to read the <a href="Event_Handling.html" title="Event Handling" class="mw-redirect">Event Handling</a> section.  The names of the events generated are:
</p>
<table>
<tr><td style="width: 100px;">mouse1</td><td>Mouse Button 1 Pressed</td></tr>
<tr><td>mouse2</td><td>Mouse Button 2 Pressed</td></tr>
<tr><td>mouse3</td><td>Mouse Button 3 Pressed</td></tr>
<tr><td>mouse1-up</td><td>Mouse Button 1 Released</td></tr>
<tr><td>mouse2-up</td><td>Mouse Button 2 Released</td></tr>
<tr><td>mouse3-up</td><td>Mouse Button 3 Released</td></tr>
<tr><td>wheel_up</td><td>Mouse Wheel rolled upwards</td></tr>
<tr><td>wheel_down</td><td>Mouse Wheel rolled downwards</td></tr>
</table>
<p>If you want to hide the mouse cursor, you want the line: "cursor hidden #t" in your <a href="Configuring_Panda.html" title="Configuring Panda" class="mw-redirect">Config.prc</a> or this section of code:
</p>

<p><b>Re-enabling mouse control</b>
</p><p>If you need to re-enable the mouse control of the camera, you have to adjust mouseInterfaceNode to the current camera transformation&#160;:
</p>

<p>Otherwise the camera would be placed back to the last position when the mouse control was enabled.
</p><p>
<b>Relative mode</b>
</p><p>Sometimes it is desirable for the mouse cursor to stay in place but still get movement events, like in a first person game.
</p>
<pre class="cpp"><span style="color: #666666;">// To set relative mode and hide the cursor:</span><br />WindowProperties props <span style="color: #000080;">=</span> window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_properties<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />props.<span style="color: #000000;">set_cursor_hidden</span> <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">true</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />props.<span style="color: #000000;">set_mouse_mode</span> <span style="color: #008000;">&#40;</span>WindowProperties<span style="color: #008080;">::</span><span style="color: #000000;">M_relative</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>request_properties <span style="color: #008000;">&#40;</span>props<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />&#160;<br /><span style="color: #666666;">// To revert to normal mode:</span><br />WindowProperties props <span style="color: #000080;">=</span> window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_properties<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />props.<span style="color: #000000;">set_cursor_hidden</span> <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">false</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />props.<span style="color: #000000;">set_mouse_mode</span> <span style="color: #008000;">&#40;</span>WindowProperties<span style="color: #008080;">::</span><span style="color: #000000;">M_absolute</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span><br />window<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>get_graphics_window<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>request_properties <span style="color: #008000;">&#40;</span>props<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span></pre>
<p>
</p><p><b>Multiple Mice</b>
</p><p>If you have multiple mice connected to a single machine, it is possible to get mouse movements and buttons for each individual mouse.  This is called <i>raw mouse input</i>.  It is really only useful if you are building an arcade machine that has lots of trackballs or spinners.
</p><p>In order to use raw mouse input, you first need to enable it.  To do so, add the following line to your panda configuration file:
</p>
<pre class="codeblock">
read-raw-mice #t
</pre>
<p>This causes the panda main window to be created with the "raw_mice" window property.  That window property, in turn, causes the window to track and store the positions and buttons of the raw mice.  Then, that data is extracted from the main window by objects of class MouseWatcher.  The application program can fetch the mouse data from the MouseWatchers.  The global variable <code>base.pointerWatcherNodes</code> contains the <code>MouseWatcher</code>s.
</p><p>The first MouseWatcher on the list always represents the system mouse pointer - a virtual mouse that moves around whenever any of the physical mice do.  Usually, you do not want to use this virtual mouse.  If you're accessing raw mice, you usually want to access the real, physical mice.  The list <code>base.pointerWatcherNodes</code> always contains the virtual system mouse first, followed by all the physical mice.
</p><p>So to print out the positions of the mice, use this:
</p>

<p>Each mouse will have a name-string, which might be something along the lines of "Micrologic High-Precision Gaming Mouse 2.0 #20245/405".  The name is the only way to tell the various mice apart.  If you have two different mice of different brands, you can easily tell them apart by the names.  If you have two mice of the same make and manufacture, then their names will be very similar, but still unique.  This is not because the mice contain serial numbers, but rather because they are uniquefied based on the USB port into which they are plugged.  That means that if you move a mouse from one USB port to another, it will have a new name.  For all practical purposes, that means that you will need to store a config file that maps mouse name to intended purpose.
</p><p>Raw mouse buttons generate events.  The event names are similar to the ones for the system mouse, except that they have a "mousedevX" prefix.  Ie, an example event might be <code>mousedev3-mouse1-up</code>.  In this example, the "mousedev3" specifier means that the mouse sending the event is <code>base.pointerWatcherNode[3]</code>.
</p><p><b>Multiple Mice under Linux</b>
</p><p>To use raw mouse input under Linux, the panda program needs to open the device files <i>/dev/input/event*</i>.  On many Linux distributions, the permission bits are set such that this is not possible.  This is a flaw in these distributions.
</p><p>It is not a good idea to just change the permission bits.  Doing so introduces a huge security hole in which any logged in user can monitor the mice, the joysticks, and the keyboard --- including any passwords that may be typed.  The correct solution is to change the ownership of the input devices whenever a user sits down at the console. There is a module, pam_console, that does this, but it is now obsoleted, and has been removed from several distros. The <a rel="nofollow" class="external text" href="http://fedoraproject.org/wiki/Releases/FeatureRemovePAMConsole">Fedora pam_console removal</a> page states that ACLs set by the HAL should replace pam_console's functionality. Currently, since it does not seem that HAL provides this yet, the best course of action is to make an 'input' group as described on <a rel="nofollow" class="external text" href="http://gizmod.wiki.sourceforge.net/HOWTO+-+Setting+Input+Device+Permissions+-+Creating+a+udev+Rule">the Gizmod wiki</a>.
</p><p>If you are building a stand-alone arcade machine that does not allow remote login and probably doesn't even have a net connection, then changing the permission bits isn't going to hurt you.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 44/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mw_manual:pcache:idhash:997-0!*!0!*!*!*!* and timestamp 20130413063556 -->
</div><div style="width:100%; padding: 1px;" class=subnavigation>
<table width="640px" cellpadding="0" cellspacing="0" border="0">
              <tr>
              <td width="70px" align="left">&nbsp;&nbsp;<a style="text-decoration:none" href="Keyboard_Support.html"><img border=0 width=16 height=16 src="arrow_left.png" align=absmiddle> <u>Prev</u></a></td>
              <td width="70px" align="center"><a style="text-decoration:none" href="Main_Page.html"><img border=0 width=16 height=16 src="arrow_up.png" align=absmiddle><u>Top</u></a></td>
              <td width="70px" align="right"><a style="text-decoration:none" href="Joystick_Support.html"><u>Next</u> <img border=0 width=16 height=16 src="arrow_right.png" align=absmiddle></a>&nbsp;&nbsp;</td>
              </tr></table></div><div id=legal>&copy; Carnegie Mellon University 2010</div></td></tr></table></td><td id=borderright></td></tr></table></td><td id=borderright></td></tr></table></body></html>